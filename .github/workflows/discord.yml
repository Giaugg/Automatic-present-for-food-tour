name: Discord Notify

on:
  push:
  pull_request:
    types: [opened, closed]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Notify Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          EVENT="${{ github.event_name }}"

          if [[ "$EVENT" == "push" ]]; then
            MSG="üöÄ Push by ${{ github.actor }} to ${{ github.ref_name }}"
          fi

          if [[ "$EVENT" == "pull_request" ]]; then
            ACTION="${{ github.event.action }}"
            TITLE="${{ github.event.pull_request.title }}"
            AUTHOR="${{ github.event.pull_request.user.login }}"

            if [[ "$ACTION" == "opened" ]]; then
              MSG="üì¢ PR Opened: $TITLE by $AUTHOR"
            elif [[ "$ACTION" == "closed" && "${{ github.event.pull_request.merged }}" == "true" ]]; then
              MSG="‚úÖ PR Merged: $TITLE"
            else
              MSG="‚ùå PR Closed (not merged): $TITLE"
            fi
          fi

          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"$MSG\"}" \
          $DISCORD_WEBHOOK
